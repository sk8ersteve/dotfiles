#!/bin/sh

# Prints the current volume or ðŸ”‡ if muted. Uses PulseAudio by default,

# Uses PulseAudio by default. Uncomment to use alsa mixer instead.
# useamixer=true

if [[ "$useamixer" != true ]]
then

    sink="$(pactl get-default-sink)"

    case $BLOCK_BUTTON in
        1) setsid "$TERMINAL" -e pulsemixer & ;;
        2) pactl set-sink-mute $sink toggle ;;
        # Faster but no max volume option
        4) pactl set-sink-volume $sink +5%;;
        5) pactl set-sink-volume $sink -5%;;
        # Slower but has max volume option
        # 4) pulsemixer --max-volume 100 --change-volume +5 ;;
        # 5) pulsemixer --max-volume 100 --change-volume -5 ;;
        # 3) changesink # This is what we would use if we were using dmenu, which we are not due to a weird bug
        3) setsid "$TERMINAL" -e changesink
#        3) notify-send "ðŸ“¢ Volume module" "\- Shows volume ðŸ”Š, ðŸ”‡ if muted.
#    - Middle click to mute.
#    - Scroll to change."
    esac

    # If muted, print mute symbol and exit now
    pactl get-sink-mute $sink | grep -q "yes" && printf "ðŸ”‡\\n" && exit

    vol="$(pactl get-sink-volume $sink | grep '[0-9]\+%' | sed "s,.* \([0-9]\+\)%.*,\1,;1q")"

else

    case $BLOCK_BUTTON in
        1) setsid "$TERMINAL" -e alsamixer & ;;
        2) amixer sset Master toggle ;;
        4) amixer sset Master 5%+ >/dev/null 2>/dev/null ;;
        5) amixer sset Master 5%- >/dev/null 2>/dev/null ;;
        3) notify-send "ðŸ“¢ Volume module" "\- Shows volume ðŸ”Š, ðŸ”‡ if muted.
    - Middle click to mute.
    - Scroll to change."
    esac

    # If muted, print mute symbol and exit now
    amixer get Master | grep "\[off\]" >/dev/null && printf "ðŸ”‡\\n" && exit

    vol=$(amixer get Master | grep -o "\[[0-9]\+%\]" | sed "s/[^0-9]*//g;1q")

fi

if [ "$vol" -gt "70" ]; then
    icon="ðŸ”Š"
elif [ "$vol" -lt "30" ]; then
    icon="ðŸ”ˆ"
else
    icon="ðŸ”‰"
fi

printf "%s %s%%\\n" "$icon" "$vol"
